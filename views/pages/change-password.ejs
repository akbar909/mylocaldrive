<%- layout('layouts/main') %>

<section style="min-height: calc(100vh - 100px); padding: 3rem 1rem;">
	<div style="max-width: 700px; margin: 0 auto;">
		<a href="/profile" style="color: var(--primary-color); text-decoration: none; font-size: 0.875rem;">‚Üê Back to Profile</a>
		<h1 style="font-size: 2rem; margin: 1rem 0 0.5rem 0;">Security Settings</h1>
		<p style="color: var(--text-light); margin-bottom: 2rem;">Manage your password and account security</p>

		<form method="POST" action="/profile/change-password" style="background: var(--white); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); margin-top: 0;">
			<h2 style="font-size: 1.25rem; margin: 0 0 1.5rem 0;"><i class="fas fa-key"></i> Change Password</h2>
			<div style="margin-bottom: 1.5rem;">
				<label style="display: block; color: var(--text-light); font-size: 0.875rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Current Password</label>
				<input type="password" name="currentPassword" required autocomplete="current-password" style="width: 100%; padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(0,0,0,0.2); color: var(--text-dark); box-sizing: border-box; font-size: 1rem;">
			</div>

			<div style="margin-bottom: 1.5rem;">
				<label style="display: block; color: var(--text-light); font-size: 0.875rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">New Password</label>
				<input type="password" name="newPassword" required minlength="8" maxlength="128" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" autocomplete="new-password" style="width: 100%; padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(0,0,0,0.2); color: var(--text-dark); box-sizing: border-box; font-size: 1rem;">
				<p style="color: var(--text-light); font-size: 0.75rem; margin-top: 0.5rem;">8+ chars, include upper, lower, and a number.</p>
			</div>

			<div style="margin-bottom: 1.5rem;">
				<label style="display: block; color: var(--text-light); font-size: 0.875rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Confirm Password</label>
				<input type="password" name="confirmPassword" required autocomplete="new-password" style="width: 100%; padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(0,0,0,0.2); color: var(--text-dark); box-sizing: border-box; font-size: 1rem;">
			</div>

			<div style="display: flex; gap: 1rem; justify-content: flex-start;">
				<button type="submit" class="btn btn-primary">Update Password</button>
				<a href="/profile" class="btn" style="background: rgba(255,255,255,0.1); color: var(--text-dark); text-decoration: none; padding: 0.75rem 1.5rem; border-radius: 8px;">Cancel</a>
			</div>
		</form>

		<!-- Delete Account Section -->
		<div style="background: var(--white); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); margin-top: 2rem; border-left: 4px solid #ef4444;">
			<h2 style="font-size: 1.25rem; margin: 0 0 1rem 0; color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h2>
			<p style="color: var(--text-light); margin-bottom: 1.5rem;">Delete your account and all associated data. This action cannot be undone.</p>
			<button onclick="confirmDeleteAccount()" class="btn" style="background: #ef4444; color: white; border: none;">
				<i class="fas fa-trash-alt"></i> Delete Account
			</button>
		</div>
	</div>
</section>

<script>
async function confirmDeleteAccount() {
	const confirmed = await showConfirm('Are you sure you want to delete your account? This will delete all your files and account data. This action cannot be undone.');
	if (!confirmed) return;
	
	fetch('/profile/delete-account', {
		method: 'POST',
		headers: { 'Content-Type': 'application/json' }
	})
	.then(res => res.json())
	.then(data => {
		if (data.success) {
			showSuccess('Account deleted successfully. Redirecting...');
			setTimeout(() => window.location.href = '/', 2000);
		} else {
			showError(data.error || 'Failed to delete account');
		}
	})
	.catch(err => {
		console.error('Delete account error:', err);
		showError('Failed to delete account');
	});
}
</script>
